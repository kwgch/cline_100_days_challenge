<!DOCTYPE html>
<html>
<head>
    <title>シンプルポーカー</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="game-container">
        <div id="game-info">
            <div id="game-state">ゲーム開始</div>
        </div>
        
        <div id="npc-area">
            <div id="npc-cards" class="cards-container">
                <!-- NPCのカード -->
            </div>
        </div>
        
        <div id="game-message"></div>
        
        <div id="player-area">
            <div id="player-cards" class="cards-container">
                <!-- プレイヤーのカード -->
            </div>
        </div>
        
        <div id="action-area">
            <div id="exchange-actions" class="action-buttons">
    <button id="exchange-button">交換</button>
            </div>
        </div>
        
        <div id="result-display" class="hidden">
            <div id="npc-hand-result"></div>
            <div id="player-hand-result"></div>
            <div id="game-result"></div>
        </div>
    </div>
    
    <script>
    (() => {
  // js/models/deck.js
  var Deck = class {
    constructor() {
      this.cards = [];
      this.suits = ["\u2660", "\u2665", "\u2666", "\u2663"];
      this.ranks = ["2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K", "A"];
      this.createDeck();
      this.shuffle();
    }
    createDeck() {
      for (let suit of this.suits) {
        for (let rank of this.ranks) {
          this.cards.push({ suit, rank });
        }
      }
    }
    shuffle() {
      for (let i = this.cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
      }
    }
    deal(numCards) {
      const dealtCards = [];
      for (let i = 0; i < numCards; i++) {
        dealtCards.push(this.cards.pop());
      }
      return dealtCards;
    }
  };

  // js/models/player.js
  var Player = class {
    constructor() {
      this.hand = [];
    }
    addCard(card) {
      this.hand.push(card);
    }
    removeCard(card) {
      this.hand = this.hand.filter((c) => c !== card);
    }
  };

  // js/models/npc.js
  var NPC = class extends Player {
    constructor(strategy) {
      super();
      this.strategy = strategy;
    }
    decideExchangeCards() {
      return this.strategy.decideExchangeCards(this.hand);
    }
  };

  // js/strategies/npcStrategy.js
  var NPCStrategy = class {
    decideExchangeCards(hand) {
      return [];
    }
  };

  // js/strategies/basicStrategy.js
  var BasicStrategy = class extends NPCStrategy {
    decideExchangeCards(hand) {
      const cardsToExchange = hand.filter((card) => parseInt(card.rank) < 6 && !isNaN(parseInt(card.rank)));
      return cardsToExchange;
    }
  };

  // js/ui/uiManager.js
  var UIManager = class {
    constructor() {
      this.gameContainer = document.getElementById("game-container");
      this.gameState = document.getElementById("game-state");
      this.npcCards = document.getElementById("npc-cards");
      this.playerCards = document.getElementById("player-cards");
      this.exchangeButton = document.getElementById("exchange-button");
      this.resultDisplay = document.getElementById("result-display");
      this.npcHandResult = document.getElementById("npc-hand-result");
      this.playerHandResult = document.getElementById("player-hand-result");
      this.gameResult = document.getElementById("game-result");
    }
    updateGameState(message) {
      this.gameState.textContent = message;
    }
    displayCards(player, cards) {
      const cardContainer = player === "player" ? this.playerCards : this.npcCards;
      cardContainer.innerHTML = "";
      cards.forEach((card) => {
        const cardElement = document.createElement("div");
        cardElement.classList.add("card");
        if (card.hidden) {
          cardElement.classList.add("hidden");
        } else {
          cardElement.textContent = `${card.rank}${card.suit}`;
          if (card.suit === "\u2665" || card.suit === "\u2666") {
            cardElement.style.color = "red";
          }
        }
        cardContainer.appendChild(cardElement);
      });
    }
    displayResults(npcHand, playerHand, result) {
      this.npcHandResult.textContent = `NPC Hand: ${npcHand}`;
      this.playerHandResult.textContent = `Player Hand: ${playerHand}`;
      this.gameResult.textContent = `Result: ${result}`;
      this.resultDisplay.classList.remove("hidden");
    }
  };

  // js/states/initialState.js
  var InitialState = class {
    constructor(context) {
      this.context = context;
    }
    enter() {
      this.context.uiManager = new UIManager();
      this.context.uiManager.updateGameState("\u30AB\u30FC\u30C9\u3092\u914D\u308A\u307E\u3059");
      this.context.deck = new Deck();
      this.context.player = new Player();
      this.context.npc = new NPC(new BasicStrategy());
      for (let i = 0; i < 5; i++) {
        this.context.player.addCard(this.context.deck.deal(1)[0]);
        this.context.npc.addCard(this.context.deck.deal(1)[0]);
      }
      this.context.uiManager.displayCards("player", this.context.player.hand);
      this.context.uiManager.displayCards("npc", this.context.npc.hand.map((card) => ({ ...card, hidden: true })));
      setTimeout(() => {
        this.context.setState("cardExchange");
      }, 1e3);
    }
    exit() {
    }
    handleAction() {
    }
  };

  // js/states/cardExchangeState.js
  var CardExchangeState = class {
    constructor(context) {
      this.context = context;
      this.selectedCards = [];
    }
    enter() {
      this.context.uiManager.updateGameState("\u30AB\u30FC\u30C9\u4EA4\u63DB");
      this.context.uiManager.displayCards("player", this.context.player.hand);
      this.context.uiManager.exchangeButton.disabled = false;
      if (this.context.uiManager.exchangeDoneButton) {
        this.context.uiManager.exchangeDoneButton.style.display = "none";
      }
      this.context.uiManager.playerCards.addEventListener("click", this.selectCard.bind(this));
      this.context.uiManager.exchangeButton.addEventListener("click", this.exchangeCardsAndEnd.bind(this));
    }
    exit() {
      this.context.uiManager.playerCards.removeEventListener("click", this.selectCard.bind(this));
      this.context.uiManager.exchangeButton.removeEventListener("click", this.exchangeCardsAndEnd.bind(this));
    }
    selectCard(event) {
      if (event.target.classList.contains("card")) {
        const cardIndex = Array.from(event.target.parentNode.children).indexOf(event.target);
        if (this.selectedCards.includes(cardIndex)) {
          this.selectedCards = this.selectedCards.filter((index) => index !== cardIndex);
          event.target.classList.remove("selected");
        } else {
          this.selectedCards.push(cardIndex);
          event.target.classList.add("selected");
        }
      }
    }
    exchangeCardsAndEnd() {
      const newCards = this.context.deck.deal(this.selectedCards.length);
      for (let i = 0; i < this.selectedCards.length; i++) {
        this.context.player.hand[this.selectedCards[i]] = newCards[i];
      }
      this.selectedCards = [];
      this.context.uiManager.displayCards("player", this.context.player.hand);
      this.context.setState("result");
    }
    handleAction(action, data) {
      if (action === "exchangeCards") {
        this.context.setState("result");
      }
    }
  };

  // js/utils/evaluator.js
  var HandEvaluator = class {
    evaluateHand(hand) {
      const ranks = hand.map((card) => card.rank);
      const suits = hand.map((card) => card.suit);
      const rankCounts = {};
      const suitCounts = {};
      for (let rank of ranks) {
        rankCounts[rank] = (rankCounts[rank] || 0) + 1;
      }
      for (let suit of suits) {
        suitCounts[suit] = (suitCounts[suit] || 0) + 1;
      }
      const counts = Object.values(rankCounts).sort((a, b) => b - a);
      const isFlush = Object.values(suitCounts).includes(5);
      const sortedRanks = ranks.map((rank) => {
        if (rank === "J") return 11;
        if (rank === "Q") return 12;
        if (rank === "K") return 13;
        if (rank === "A") return 14;
        return parseInt(rank);
      }).sort((a, b) => a - b);
      const isStraight = sortedRanks.every((rank, index) => {
        if (index === 0) return true;
        return rank === sortedRanks[index - 1] + 1;
      });
      const isRoyal = isStraight && isFlush && sortedRanks[0] === 10;
      if (isRoyal) return "Royal Flush";
      if (isStraight && isFlush) return "Straight Flush";
      if (counts[0] === 4) return "Four of a Kind";
      if (counts[0] === 3 && counts[1] === 2) return "Full House";
      if (isFlush) return "Flush";
      if (isStraight) return "Straight";
      if (counts[0] === 3) return "Three of a Kind";
      if (counts[0] === 2 && counts[1] === 2) return "Two Pair";
      if (counts[0] === 2) return "Pair";
      return "High Card";
    }
  };

  // js/states/resultState.js
  var ResultState = class {
    constructor(context) {
      this.context = context;
    }
    enter() {
      this.context.uiManager.updateGameState("\u7D50\u679C\u8868\u793A");
      const playerHand = this.context.player.hand;
      const npcHand = this.context.npc.hand;
      const evaluator = new HandEvaluator();
      const playerHandResult = evaluator.evaluateHand(playerHand);
      const npcHandResult = evaluator.evaluateHand(npcHand);
      let gameResult = "";
      if (playerHandResult > npcHandResult) {
        gameResult = "\u30D7\u30EC\u30A4\u30E4\u30FC\u306E\u52DD\u5229\uFF01";
      } else if (npcHandResult > playerHandResult) {
        gameResult = "NPC\u306E\u52DD\u5229\uFF01";
      } else {
        gameResult = "\u5F15\u304D\u5206\u3051\uFF01";
      }
      this.context.uiManager.displayCards("npc", this.context.npc.hand);
      this.context.uiManager.displayResults(npcHandResult, playerHandResult, gameResult);
    }
    exit() {
    }
  };

  // js/utils/eventEmitter.js
  var EventEmitter = class {
    constructor() {
      this.events = {};
    }
    on(event, listener) {
      if (!this.events[event]) {
        this.events[event] = [];
      }
      this.events[event].push(listener);
    }
    emit(event, data) {
      if (this.events[event]) {
        this.events[event].forEach((listener) => listener(data));
      }
    }
  };

  // js/states/gameContext.js
  var GameContext = class {
    constructor() {
      this.states = {
        initial: new InitialState(this),
        cardExchange: new CardExchangeState(this),
        result: new ResultState(this)
      };
      this.currentState = this.states.initial;
      this.player = null;
      this.npc = null;
      this.deck = null;
      this.events = new EventEmitter();
    }
    start() {
      this.currentState.enter();
    }
    setState(stateName) {
      this.currentState.exit();
      this.currentState = this.states[stateName];
      this.currentState.enter();
    }
    handleAction(action, data) {
      this.currentState.handleAction(action, data);
    }
  };

  // js/main.js
  document.addEventListener("DOMContentLoaded", () => {
    const game = new GameContext();
    game.start();
  });
})();
    </script>
</body>
</html>
