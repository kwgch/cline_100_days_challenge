## 1. 仕様書

### 1.1. 概要

本アプリケーションは、Web ブラウザ上で動作する Transformer ベースの言語モデル (DistilBERT) の内部挙動可視化ツールである。ユーザーはテキストを入力し、モデルの推論プロセスにおけるアテンションメカニズムを視覚的に確認することで、モデルがどのようにテキストを理解・処理しているかについての洞察を得ることを目的とする。

### 1.2. 機能要件

*   **FR-01: テキスト入力:** ユーザーは、分析対象となるテキストを UI 上のテキストエリアに入力できる。
*   **FR-02: モデル読み込み:** アプリケーションは、事前に TensorFlow.js 形式に変換され、アテンション重みを出力するよう設定された DistilBERT モデルをロードする。ロード状況（進捗、完了、エラー）をユーザーに表示する。
*   **FR-03: 推論実行:** ユーザーが実行ボタンを押すと、入力されたテキストに対して DistilBERT モデルによる推論（例: マスクされたトークンの予測、分類など。モデルの出力に依存）を実行する。
*   **FR-04: アテンションデータ取得:** 推論実行時に、モデルの中間出力であるアテンション重みを取得する。
*   **FR-05: アテンション可視化 (ヘッドビュー):**
    *   指定したレイヤー、指定したアテンションヘッドにおける、トークン間のアテンションスコアを線で結んで表示する (BertViz の Head View に相当)。
    *   ユーザーはレイヤーとヘッドを選択できる UI を持つ。
    *   アテンションの強さを線の太さや色で表現する。
    *   特定のトークンにマウスオーバーすると、関連するアテンションがハイライトされる。
*   **FR-06: アテンション可視化 (モデルビュー):** (オプション)
    *   全レイヤー、全ヘッドのアテンションを俯瞰的に表示する (BertViz の Model View に相当)。
    *   トークン間の接続線をまとめて表示し、モデル全体の注意パターンを示す。
*   **FR-07: 結果表示:** モデルの最終的な推論結果（予測されたトークンや分類結果など）をテキスト形式で表示する。

### 1.3. 非機能要件

*   **NFR-01: 対応ブラウザ:** 最新版の Google Chrome, Firefox, Safari, Microsoft Edge で動作すること。
*   **NFR-02: パフォーマンス:**
    *   モデルのロード時間は、ネットワーク環境に依存するが、適切なフィードバックを表示する。
    *   推論実行とアテンション可視化の描画は、一般的な PC 環境において数秒以内に完了することを目指す (モデルサイズ、テキスト長に依存)。
*   **NFR-03: UI/UX:**
    *   直感的で分かりやすいインターフェースを提供する。
    *   可視化結果はインタラクティブに操作（レイヤー/ヘッド選択、マウスオーバー）できること。
*   **NFR-04: モデル:** 使用する DistilBERT モデルは、事前に TensorFlow.js GraphModel 形式に変換されており、アテンション重みが Named Outputs としてアクセス可能になっている必要がある。

### 1.4. 用語定義

*   **DistilBERT:** BERT を蒸留（Distillation）によって軽量化した Transformer モデル。
*   **TensorFlow.js (TFJS):** ブラウザおよび Node.js で機械学習モデルを開発・実行するための JavaScript ライブラリ。
*   **アテンション (Attention):** Transformer モデルにおいて、入力シーケンス内の異なる単語間の関連性の重み。
*   **アテンションヘッド (Attention Head):** Multi-Head Attention における個々のアテンション計算ユニット。
*   **レイヤー (Layer):** Transformer モデルを構成する層。
*   **ヘッドビュー (Head View):** 特定のレイヤー/ヘッドのアテンションをトークン間の線で表示する可視化手法。
*   **モデルビュー (Model View):** 全レイヤー/ヘッドのアテンションを俯瞰的に表示する可視化手法。

---